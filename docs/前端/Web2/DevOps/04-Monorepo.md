# Monorepo

Monorepo（单一代码仓库）是一种代码管理方式，它将多个项目或多个服务存放在同一个版本控制仓库中，而不是将每个项目或服务分别放在不同的仓库中
## 一、 Monorepo相关
### Monorepo的特点：
- 多个项目共享一个仓库：在Monorepo中，所有的代码、配置文件、依赖项等都集中在一个仓库里。不同的服务或模块通常在仓库中以子目录的形式存在。  
- 统一管理依赖和版本：所有项目共享相同的依赖版本，方便在多个项目之间进行协作和版本升级。所有项目的依赖更新可以集中管理，避免了版本冲突和不一致的问题。  
- 代码重用和共享：通过将不同的项目放在同一个仓库中，团队能够方便地共享和重用代码。例如，某个通用模块可以被多个子项目引用，不需要单独管理版本和更新。  
- 统一的构建和测试：通常使用一些工具来管理Monorepo中的构建和测试，确保在一个仓库中的多个项目能够一起工作，且不会因为某个项目的更改影响到其他项目。  
- 简化跨项目的协作：开发人员能够更容易地进行跨项目的协作，因为所有的代码都在一个地方，可以直接查看和修改其他项目的代码。


###  Monorepo 的核心优势

1. **代码共享**：不同的项目可以轻松共享相同的模块，避免重复开发。
2. **版本一致性**：多个项目可以使用相同的依赖版本，减少版本冲突问题。
3. **跨项目协作**：更容易在多个项目之间进行修改，确保功能兼容性。
4. **统一的 CI/CD**：可以在一个 CI/CD 流水线中构建、测试和发布所有项目。
5. **改动可见性**：团队成员能更清楚地了解代码库的整体变化，避免不必要的 API 破坏性变更。


### 🏗 Monorepo 常见管理工具

Monorepo 需要强大的工具来管理依赖、构建和发布，以下是几种常见工具：

| 工具          | 主要特点                                             |
| ------------- | ---------------------------------------------------- |
| **Lerna**     | 适用于 JavaScript/TypeScript，管理版本发布、依赖关系 |
| **Nx**        | 强大的任务执行器，支持微前端、微服务、CI 优化        |
| **Turborepo** | 高性能的构建系统，缓存任务，提高构建速度             |
| **Bazel**     | 适用于大型项目，支持多语言构建，强依赖管理           |
| **Rush**      | 适合大规模团队，提供一致的包管理策略                 |

如果你是前端开发，**Lerna + Yarn Workspaces** 或 **Nx** 是比较常见的组合。


### 🏗 Monorepo 结构示例

以 `pnpm` + `TurboRepo` 作为示例，目录结构可能如下：
```
my-monorepo/
├── apps/          # 存放应用
│   ├── web/       # 前端项目
│   ├── admin/     # 管理后台
│   ├── api/       # 后端服务
│
├── packages/      # 存放共享包
│   ├── ui/        # 共享 UI 组件
│   ├── utils/     # 公共工具函数
│   ├── config/    # 共享配置
│
├── turbo.json     # TurboRepo 配置
├── package.json   # 统一管理工作区依赖
├── pnpm-workspace.yaml # pnpm 工作区配置

```
### 🚀 如何选择 Monorepo 工具？

- **如果你的项目主要是前端应用（React/Vue）**
  - 选择 **Turborepo**（高性能）或 **Nx**（功能全面）。
- **如果是 Node.js 项目，需要发布 NPM 包**
  - 选择 **Lerna + pnpm**，或者 **Rush**（大团队）。
- **如果是大型工程，多语言混合（如 Go、Python、Java）**
  - 选择 **Bazel**。


### 📌 Monorepo 的挑战

1. **构建时间变长**：大型 Monorepo 可能会导致 CI/CD 变慢，需要优化（如 `Turborepo` 的缓存机制）。
2. **访问权限管理复杂**：不同团队可能只需要部分代码库的权限，Monorepo 需要额外的访问控制策略。
3. **工具选型复杂**：不同工具的适用场景不同，需要根据团队需求选择合适的 Monorepo 方案。





## 二、 浩辰教育系统 Monorepo 结构设计

### **Monorepo 整体结构**
```bash
gdgts-monorepo/
├── apps/                  # 前端应用
│   ├── student/           # 学员端ST (Vue3)
│   ├── admin/             # 运营后台端OA (Vue3 + Admin Dashboard)
│   └── tenant/            # 租户管理端TM (Vue3)
├── packages/              # 共享代码库
│   ├── shared/            # 通用工具函数、常量、类型定义
│   ├── ui-kit/            # 公共UI组件库 (Ant Design/Custom)
│   ├── api-client/        # 统一API客户端 (Axios封装)
│   ├── auth-sdk/          # 认证SDK (JWT管理、权限校验)
│   └── data-models/       # 数据模型 (试题、试卷、用户等TS接口)
└── tools/                 # 工程化工具
    ├── eslint-config/     # 统一ESLint配置
    └── jest-config/       # 统一测试配置
```


### **核心模块拆分**
#### **1. 前端应用（`apps/`）**
- **学员端ST**  
  - 模块：考试答题、收藏中心、首页（个人信息、快捷入口）  
  - 技术栈：Vue3 + 状态管理（Pinia）  
  - 依赖共享包：`ui-kit`, `api-client`, `auth-sdk`

- **运营后台端OA**  
  - 模块：租户管理、资源管理、数据分析  
  - 技术栈：Vue3 + Admin框架（Element Plus）  
  - 依赖共享包：`ui-kit`, `api-client`, `data-models`

- **租户管理端TM**  
  - 模块：题库管理、考试管理、人员管理、考务评分  
  - 技术栈：Vue3 + 复杂表单逻辑  
  - 依赖共享包：`ui-kit`, `api-client`, `auth-sdk`, `data-models`


#### **2. 后端服务（`services/`）**
- **认证服务（auth）**  
  - 功能：租户/用户登录、权限校验、免密登录  
  - 目录服务？？？？？

- **考试服务（exam）**  
  - 功能：试题录入、试卷生成、防作弊逻辑、自动评分  

- **资源服务（resource）**  
  - 功能：题库/试卷资源管理、资源包制作、EXCEL批量操作  

- **租户服务（tenant）**  
  - 功能：租户权限期限、管理员分配、数据隔离  

- 学生端推荐算法？？？



#### **3. 共享代码库（`packages/`）**
- **`ui-kit`**  
  - 公共组件：表格、表单、弹窗、考试计时器、文件上传  
  - 样式：全局主题变量、Ant Design/Custom主题覆盖

- **`api-client`**  
  - 统一封装：请求拦截、错误处理、接口类型声明（基于OpenAPI生成）

- **`auth-sdk`**  
  - 功能：Token管理、路由权限校验（如学员端与管理员端路由隔离）

- **`data-models`**  
  - 类型定义：试题（`Question`）、试卷（`Exam`）、用户（`User`）等TS接口


### **关键设计点**
1. **依赖管理**  
   - 使用 **Yarn Workspaces + Lerna** 管理Monorepo依赖，避免重复安装。  
   - 通过`packages/*`共享代码，严格定义模块边界（如`tenant-app`不直接依赖`student-app`）。

2. **自动化与工程化**  
   - 全局ESLint/Prettier配置，确保代码风格统一。  
   - 使用Turborepo加速构建缓存，按需触发应用/服务构建。  
  

### **技术选型**
- **前端**：Vue3 + TypeScript + Vite（轻量快速）  
- **工具链**：Yarn 3（Workspaces）、Turborepo（构建优化）、Jest（单元测试）













## 参考
- [带你了解更全面的 Monorepo - 优劣、踩坑、选型](https://juejin.cn/post/7215886869199896637)
- [5 分钟搞懂 Monorepo](https://xie.infoq.cn/article/4f870ba6a7c8e0fd825295c92)